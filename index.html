<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© Ø§Ù„Ù„Ø§Ù…Ø±ÙƒØ²ÙŠ ğŸ›¡ï¸</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f4f8; text-align: center; padding: 20px; }
        .app-container { background: white; max-width: 450px; margin: auto; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .status-badge { padding: 10px; border-radius: 10px; margin: 15px 0; font-weight: bold; font-size: 14px; }
        .idle { background: #e2e8f0; color: #475569; }
        .trusted { background: #dcfce7; color: #166534; }
        .warning { background: #fee2e2; color: #991b1b; }
        button#authBtn { width: 100%; padding: 20px; font-size: 18px; border: none; border-radius: 15px; background: #4f46e5; color: white; cursor: pointer; touch-action: none; transition: 0.2s; }
        button#authBtn:active { transform: scale(0.96); background: #4338ca; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; }
        canvas { width: 100%; height: 150px; background: #f8fafc; border-radius: 12px; margin-top: 20px; border: 1px solid #e2e8f0; }
        #peer-info { font-size: 12px; color: #64748b; background: #f1f5f9; padding: 10px; border-radius: 8px; word-break: break-all; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="app-container">
    <h2>Ø§Ù„Ù…ØªØ§Ù‡Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© ğŸ›¡ï¸</h2>
    <div id="peer-info">Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù Ù‡ÙˆÙŠØªÙƒ Ø§Ù„Ù„Ø§Ù…Ø±ÙƒØ²ÙŠØ©...</div>
    
    <input type="text" id="targetId" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± Ù„Ù„Ø±Ø¨Ø·">
    <button id="connectBtn" style="background: #10b981; font-size: 14px; padding: 10px; margin-bottom: 20px;">Ø±Ø¨Ø· Ø§Ù„Ø¹Ù‚Ø¯ ğŸ”—</button>

    <div id="displayStatus" class="status-badge idle">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù„Ù…Ø³ Ø£Ùˆ Ø§Ù„Ø±Ø¨Ø·...</div>
    
    <button id="authBtn">Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ© Ø¨Ø§Ù„Ù„Ù…Ø³</button>
    
    <canvas id="liveGraph"></canvas>
</div>

<script type="module">
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù‚Ù„ Ø§Ù„Ù…Ø¯Ø¨Ø± ÙˆØ¬Ù‡Ø§Ø² Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠ
    import { BehavioralEngine } from './behavior.js';
    import { P2PNetwork } from './network.js';

    const engine = new BehavioralEngine();
    let startTime = 0;
    const points = [];

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ©
    const net = new P2PNetwork((data) => {
        updateUI(data.includes("âœ…") ? "trusted" : "warning", "Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ©: " + data);
    });

    net.init((id) => {
        document.getElementById('peer-info').innerText = "Ù…Ø¹Ø±ÙÙƒ: " + id;
    });

    document.getElementById('connectBtn').onclick = () => {
        const targetId = document.getElementById('targetId').value;
        net.connect(targetId);
        updateUI("idle", "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø±Ø¨Ø· ğŸ”—");
    };

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù„Ù…Ø³
    const btn = document.getElementById('authBtn');
    btn.onpointerdown = () => startTime = performance.now();
    btn.onpointerup = () => {
        const duration = performance.now() - startTime;
        const result = engine.analyze(duration, 0);

        let msg = "";
        if (result.learning) {
            msg = `Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨... (${engine.model.count}/5)`;
            updateUI("idle", msg);
        } else {
            msg = result.ok ? "ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØªÙƒ âœ…" : "ØªØ­Ø°ÙŠØ±: Ù†Ù…Ø· ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚! âŒ";
            updateUI(result.ok ? "trusted" : "warning", msg);
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± Ø¹Ø¨Ø± P2P
            net.sendValidation(msg);
        }

        renderGraph(1000/duration, result.ok);
    };

    function updateUI(status, text) {
        const el = document.getElementById('displayStatus');
        el.className = `status-badge ${status}`;
        el.innerText = text;
    }

    function renderGraph(vel, ok) {
        const canvas = document.getElementById('liveGraph');
        const ctx = canvas.getContext('2d');
        points.push({vel, ok});
        if(points.length > 25) points.shift();

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        points.forEach((p, i) => {
            ctx.fillStyle = p.ok ? "#3b82f6" : "#ef4444";
            ctx.beginPath();
            ctx.arc((i * 12) + 10, canvas.height - (p.vel * 10), 5, 0, Math.PI * 2);
            ctx.fill();
        });
    }
</script>

</body>
</html>
